# learn-google-calender-api

## oauth について
オーソドックスな Google Calender API で予定を追加するためのコードです。

## serviceaccountV2 について
スケジュールに attendee を追加するにはサービスアカウントに対するドメイン全体の委任が必要ですが、serviceaccountV2 ではハック実装によりそれを回避する方法を提供します。
これにより、権限が弱くても擬似 attendee 特定の参加者のみをスケジュールへ招待することが可能になります。

### 理屈
Google Calender API を使う場合、サービスアカウントに対するドメイン全体の委任なしでは attendee を追加することができません。しかし、サービスアカウントに対してカレンダーを複数作成し、そのカレンダーに対してユーザーを編集権限で追加し、カレンダー単位で予定を追加することは可能です。これを利用すると、1ユーザー1カレンダーを割り当てることができ、ユーザー単位でスケジュールを登録できるようになるため、擬似 attendee 的なことができます。

### 使い方
以下は新規ユーザーに対して予定を登録する方法です。
まず1つカレンダーを払い出します。（基本的に1ユーザーにつき1つ払い出します。）

```
npm run create
```

次にカレンダーにユーザーを追加します。

```
npm run add-member
```

ユーザーにメールが送信されるので、それメールからカレンダーを追加してもらうことができます。
これでユーザーにカレンダーが見えるようになり、以降はこのカレンダーに予定を追加することでユーザーが閲覧できる状態になります。

スケジュールを次のコマンドで追加します。

```
npm run add-schedule
```

### 管理用コマンド
サービスアカウントに対して払い出したカレンダーを一覧表示

```
npm run list
```

サービスアカウントに紐づくカレンダーを削除

```
npm run delete
```
